<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote - SlideChangerOnline</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Style for the preview image to maintain aspect ratio */
        #preview-image {
            aspect-ratio: 16 / 9;
            object-fit: contain; /* Ensures the whole image is visible */
            background-color: #374151; /* bg-gray-700 */
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">
    <div id="loading-message" class="text-center">
        <p class="text-xl">Connecting to presentation...</p>
    </div>

    <div id="error-message" class="hidden text-center">
        <p class="text-xl text-red-400">Could not connect. The presentation may have expired or the link is invalid.</p>
    </div>

    <div id="remote-controls" class="hidden w-full max-w-sm text-center">
        <h1 class="text-2xl font-bold mb-4">Remote Control</h1>
        
        <!-- NEW: Preview Screen -->
        <div class="mb-6 bg-gray-800 rounded-lg p-2 shadow-lg">
            <img id="preview-image" src="" alt="Current Slide Preview" class="rounded-md w-full">
        </div>

        <div id="page-indicator" class="text-2xl font-light mb-6 bg-gray-800 rounded-lg py-3">
            Page 1 of 1
        </div>

        <div class="grid grid-cols-2 gap-4">
            <button id="prev-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-6 rounded-lg text-2xl transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                Prev
            </button>
            <button id="next-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-6 rounded-lg text-2xl transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                Next
            </button>
        </div>
    </div>

     <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
  apiKey: "AIzaSyCtlgsNhCEsKLHA-WmfoqQleW_n2kCQerI",
  authDomain: "slidechangeronline.firebaseapp.com",
  projectId: "slidechangeronline",
  storageBucket: "slidechangeronline.firebasestorage.app",
  messagingSenderId: "1013262596418",
  appId: "1:1013262596418:web:b7c9ee7e6da7545ff370db"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const loadingMessage = document.getElementById('loading-message');
        const errorMessage = document.getElementById('error-message');
        const remoteControls = document.getElementById('remote-controls');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const pageIndicator = document.getElementById('page-indicator');
        const previewImage = document.getElementById('preview-image'); // Get the new image element

        let currentPage = 1;
        let totalPages = 1;

        const params = new URLSearchParams(window.location.search);
        const presentationId = params.get('id');

        if (presentationId) {
            const docRef = doc(db, "presentations", presentationId);

            onSnapshot(docRef, (doc) => {
                if (doc.exists()) {
                    loadingMessage.classList.add('hidden');
                    remoteControls.classList.remove('hidden');

                    const data = doc.data();
                    currentPage = data.currentPage || 1;
                    totalPages = data.totalPages || 1; 

                    // Update the preview image source
                    if (data.previewImage) {
                        previewImage.src = data.previewImage;
                    }

                    pageIndicator.textContent = `Page ${currentPage} of ${totalPages}`;

                    prevBtn.disabled = (currentPage <= 1);
                    nextBtn.disabled = (currentPage >= totalPages);

                } else {
                    loadingMessage.classList.add('hidden');
                    errorMessage.classList.remove('hidden');
                }
            }, (error) => {
                console.error("Error connecting:", error);
                loadingMessage.classList.add('hidden');
                errorMessage.classList.remove('hidden');
            });
            
            prevBtn.addEventListener('click', () => {
                if (prevBtn.disabled) return;
                const newPage = currentPage - 1;
                updateDoc(docRef, { currentPage: newPage });
            });

            nextBtn.addEventListener('click', () => {
                if (nextBtn.disabled) return;
                const newPage = currentPage + 1;
                updateDoc(docRef, { currentPage: newPage });
            });

        } else {
            loadingMessage.classList.add('hidden');
            errorMessage.classList.remove('hidden');
        }
    </script>
</body>
</html>

