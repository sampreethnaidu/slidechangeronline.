<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SlideChangerOnline - Your Remote PDF Presenter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        .cambria-font {
            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="flex flex-col items-center justify-center min-h-screen p-4">

        <!-- Main Card -->
        <div class="w-full max-w-2xl bg-white rounded-2xl shadow-2xl p-8 md:p-12 text-center">

            <header class="mb-8">
                <h1 class="cambria-font text-5xl font-bold text-gray-900">
                    SlideChangerOnline
                </h1>
                <p class="text-gray-500 mt-2">The easiest way to present your PDFs, remotely.</p>
            </header>

            <div id="user-info" class="hidden mb-4">
                <p id="welcome-message" class="text-lg"></p>
                <button id="signout-btn" class="mt-2 text-sm text-indigo-600 hover:underline">Sign Out</button>
            </div>

            <div id="upload-section" class="hidden mb-8">
                <p class="mb-4 text-lg">You're signed in! Upload your PDF to get started.</p>
                
                <label for="pdf-upload" class="group cursor-pointer inline-flex items-center justify-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105 shadow-lg">
                    <svg class="w-6 h-6 mr-3 transform group-hover:rotate-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                    Choose your PDF
                </label>
                <input type="file" id="pdf-upload" class="hidden" accept=".pdf">
                
                <div id="upload-progress-container" class="hidden mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="upload-progress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <p id="upload-status" class="text-sm text-gray-600 mt-2"></p>
                </div>

                <p class="text-sm text-gray-400 mt-4">Free users can upload one file at a time (Max 10MB).</p>
            </div>
            
            <div id="auth-section">
                 <p class="mb-4 text-lg">Please sign in with Google to continue.</p>
                 <button id="login-btn" class="bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-8 rounded-lg transition-transform transform hover:scale-105 shadow-md inline-flex items-center">
                    <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.022,35.222,44,30.036,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                    Sign In with Google
                </button>
            </div>

            <div id="links-section" class="hidden mt-10 p-6 bg-gray-50 rounded-lg border border-gray-200">
                 <h2 class="text-2xl font-semibold mb-4 text-gray-800">Your Links are Ready!</h2>
                 
                 <div class="space-y-4">
                     <div>
                         <label class="font-medium text-gray-700 block text-left mb-1">Presenter Link (for the big screen):</label>
                         <div class="flex items-center">
                            <input type="text" id="presenter-link" readonly class="w-full p-2 border border-gray-300 rounded-l-md bg-gray-200 font-mono text-sm">
                            <button id="copy-presenter" class="bg-indigo-500 text-white p-2 rounded-r-md hover:bg-indigo-600">Copy</button>
                         </div>
                     </div>
                     
                     <div>
                         <label class="font-medium text-gray-700 block text-left mb-1">Remote Link (for your phone):</label>
                         <div class="flex items-center">
                             <input type="text" id="remote-link" readonly class="w-full p-2 border border-gray-300 rounded-l-md bg-gray-200 font-mono text-sm">
                            <button id="copy-remote" class="bg-indigo-500 text-white p-2 rounded-r-md hover:bg-indigo-600">Copy</button>
                         </div>
                     </div>
                 </div>
                 <p class="text-sm text-gray-500 mt-6">These links will expire in <span id="timer" class="font-bold">10 minutes</span>.</p>
            </div>
        </div>
        
        <footer class="mt-8 text-center">
            <p class="text-gray-500">Â© 2025 SlideChangerOnline. All Rights Reserved.</p>
        </footer>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
  apiKey: "AIzaSyCtlgsNhCEsKLHA-WmfoqQleW_n2kCQerI",
  authDomain: "slidechangeronline.firebaseapp.com",
  projectId: "slidechangeronline",
  storageBucket: "slidechangeronline.firebasestorage.app",
  messagingSenderId: "1013262596418",
  appId: "1:1013262596418:web:b7c9ee7e6da7545ff370db"
};

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const storage = getStorage(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // Get UI elements
        const loginBtn = document.getElementById('login-btn');
        const signoutBtn = document.getElementById('signout-btn');
        const authSection = document.getElementById('auth-section');
        const uploadSection = document.getElementById('upload-section');
        const userInfo = document.getElementById('user-info');
        const welcomeMessage = document.getElementById('welcome-message');
        const pdfUploadInput = document.getElementById('pdf-upload');
        const progressContainer = document.getElementById('upload-progress-container');
        const progressBar = document.getElementById('upload-progress-bar');
        const uploadStatus = document.getElementById('upload-status');
        const linksSection = document.getElementById('links-section');
        const presenterLinkInput = document.getElementById('presenter-link');
        const remoteLinkInput = document.getElementById('remote-link');
        const copyPresenterBtn = document.getElementById('copy-presenter');
        const copyRemoteBtn = document.getElementById('copy-remote');

        // Handle Login & Signout
        loginBtn.addEventListener('click', () => signInWithPopup(auth, provider));
        signoutBtn.addEventListener('click', () => signOut(auth));

        // Listen for authentication state changes
        onAuthStateChanged(auth, (user) => {
            if (user) {
                authSection.classList.add('hidden');
                userInfo.classList.remove('hidden');
                uploadSection.classList.remove('hidden');
                welcomeMessage.textContent = `Welcome, ${user.displayName}!`;
            } else {
                authSection.classList.remove('hidden');
                userInfo.classList.add('hidden');
                uploadSection.classList.add('hidden');
                linksSection.classList.add('hidden'); // Hide links on sign out
            }
        });

        // Handle File Upload Logic
        pdfUploadInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return; 

            if (file.type !== "application/pdf" || file.size > 10 * 1024 * 1024) {
                alert("Please select a PDF file under 10MB.");
                return;
            }
            const user = auth.currentUser;
            if (!user) {
                alert("You must be signed in to upload a file.");
                return;
            }

            progressContainer.classList.remove('hidden');
            const storageRef = ref(storage, `uploads/${user.uid}/${Date.now()}-${file.name}`);
            const uploadTask = uploadBytesResumable(storageRef, file);

            uploadTask.on('state_changed', 
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    uploadStatus.textContent = `Uploading... ${Math.round(progress)}%`;
                    progressBar.style.width = progress + '%';
                }, 
                (error) => {
                    console.error("Upload failed:", error);
                    uploadStatus.textContent = `Upload failed. Please try again.`;
                }, 
                () => {
                    uploadStatus.textContent = 'Upload complete! Generating links...';
                    getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                        console.log('File available at', downloadURL);
                        createPresentationSession(downloadURL, user.uid);
                    });
                }
            );
        });

        async function createPresentationSession(fileUrl, ownerId) {
            try {
                const sessionData = {
                    fileUrl: fileUrl,
                    ownerId: ownerId,
                    currentPage: 1,
                    createdAt: serverTimestamp() 
                };
                
                const docRef = await addDoc(collection(db, "presentations"), sessionData);
                console.log("Document written with ID: ", docRef.id);

                const presenterURL = `${window.location.origin}/presenter.html?id=${docRef.id}`;
                const remoteURL = `${window.location.origin}/remote.html?id=${docRef.id}`;

                presenterLinkInput.value = presenterURL;
                remoteLinkInput.value = remoteURL;

                uploadSection.classList.add('hidden');
                linksSection.classList.remove('hidden');

            } catch (e) {
                console.error("Error adding document: ", e);
                uploadStatus.textContent = 'Failed to create session. Please try again.';
            }
        }

        copyPresenterBtn.addEventListener('click', () => {
            presenterLinkInput.select();
            document.execCommand('copy');
            copyPresenterBtn.textContent = 'Copied!';
            setTimeout(() => { copyPresenterBtn.textContent = 'Copy'; }, 2000);
        });

        copyRemoteBtn.addEventListener('click', () => {
            remoteLinkInput.select();
            document.execCommand('copy');
            copyRemoteBtn.textContent = 'Copied!';
            setTimeout(() => { copyRemoteBtn.textContent = 'Copy'; }, 2000);
        });

    </script>
</body>
</html>

